---
import { SITE_CONFIG } from '@utils/constants';

const currentPath = Astro.url.pathname;

const navLinks = [
  { href: '/', label: 'ANASAYFA' },
  { href: '/hizmetlerimiz', label: 'HİZMETLERİMİZ' },
  { href: '/hakkimizda', label: 'HAKKIMIZDA' },
  { href: '/blog', label: 'BLOG' },
  { href: '/iletisim', label: 'İLETİŞİM' },
];
---

<header class="fixed top-0 left-0 right-0 z-40 transition-all duration-300 border-b border-white/5" id="header" style="background: rgba(15, 23, 42, 0.8); backdrop-filter: blur(12px);">
  
  {/* Matrix/Tech Ticker for Mobile */}
  <div class="header-ticker lg:hidden bg-black border-b border-white/10 h-[30px] flex items-center justify-center overflow-hidden relative">
    <div class="absolute inset-0 bg-black z-0"></div>
    {/* Scanline effect */}
    <div class="absolute inset-0 z-10 pointer-events-none opacity-10 bg-[linear-gradient(to_bottom,transparent_50%,rgba(0,0,0,0.5)_50%)] bg-[size:100%_4px]"></div>
    
    <div class="ticker-content relative z-20 flex items-center gap-2 font-mono text-xs font-bold tracking-wider">
      <span class="text-green-500 opacity-70 mr-1">&gt;</span>
      <span id="typewriter-text" class="text-green-400 text-shadow-neon"></span>
      <span class="cursor-blink w-2 h-4 bg-green-500 inline-block ml-1"></span>
    </div>
  </div>

  <div class="container relative">
    <div class="flex items-center justify-between h-16 lg:h-[68px]">
      {/* Logo */}
      <a href="/" class="flex items-center gap-3 group relative z-10">
        <div class="relative">
          <img 
            src="/images/DSG Servis logosu.webp" 
            alt="DSG Servisi - Yıldızlar Grup" 
            class="h-8 md:h-10 w-auto transition-all duration-300 group-hover:scale-105 relative z-10 filter brightness-105"
            loading="eager"
            fetchpriority="high"
            width="48"
            height="48"
            decoding="async"
          />
        </div>
      </a>

      {/* Desktop Navigation */}
      <nav class="hidden lg:flex items-center gap-8 relative z-10">
        {navLinks.map((link) => (
          <a
            href={link.href}
            class={`text-sm tracking-wide font-semibold hover:text-white transition-colors duration-200 relative group ${
              currentPath === link.href ? 'text-white' : 'text-slate-400'
            }`}
          >
            {link.label}
            <span class={`absolute -bottom-1 left-0 h-0.5 bg-primary transition-all duration-300 ${currentPath === link.href ? 'w-full' : 'w-0 group-hover:w-full'}`}></span>
          </a>
        ))}
      </nav>

      {/* CTA Button - Solid Tech Look */}
      <a 
        href={`tel:${SITE_CONFIG.phoneTel}`}
        class="hidden md:inline-flex items-center justify-center px-5 py-2.5 rounded text-sm font-bold text-white transition-all duration-300 relative z-10 overflow-hidden group border border-primary/50 bg-primary/10 hover:bg-primary"
        onmousedown="if(window.gtag){window.gtag('event','header_fiyat_iste_butonu',{location:'header_nav'});}"
      >
        <span class="relative z-10 flex items-center gap-2">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/></svg>
          FİYAT İSTE
        </span>
      </a>

      {/* Mobile Menu Button */}
      <button 
        id="mobile-menu-btn"
        class="lg:hidden text-white/90 p-2 relative z-[101] hover:text-white transition-all duration-200"
        aria-label="Menüyü Aç"
      >
        <svg id="menu-icon" class="w-8 h-8 transition-transform duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
        </svg>
        <svg id="close-icon" class="w-8 h-8 hidden transition-transform duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
    </div>
  </div>

</header>

{/* Mobile Menu - Header DIŞINDA, tam ekran kaplayacak */}
<div id="mobile-menu-panel" class="fixed inset-0 z-[9999] hidden lg:hidden flex flex-col" style="background-color: #0f172a;">
  {/* Arka Plan Desenleri */}
  <div class="absolute inset-0 overflow-hidden pointer-events-none" style="background-color: #0f172a;">
    <div class="absolute inset-0 bg-[linear-gradient(to_right,#ffffff08_1px,transparent_1px),linear-gradient(to_bottom,#ffffff08_1px,transparent_1px)] bg-[size:14px_24px]"></div>
    <div class="absolute top-0 right-0 -translate-y-12 translate-x-12 w-96 h-96 bg-amber-500/15 rounded-full blur-3xl"></div>
    <div class="absolute bottom-0 left-0 translate-y-12 -translate-x-12 w-96 h-96 bg-blue-600/15 rounded-full blur-3xl"></div>
  </div>
  
  {/* Menü İçeriği */}
  <div class="p-6 pt-24 flex-1 relative z-10 flex flex-col">
    <div class="space-y-2">
      {navLinks.map((link, index) => (
        <a
          href={link.href}
          class={`block py-4 px-4 text-lg font-bold tracking-wide rounded-xl transition-all duration-300 ${
            currentPath === link.href 
              ? 'bg-amber-500/10 text-amber-500 border border-amber-500/20 pl-6' 
              : 'text-slate-300 hover:text-white hover:bg-white/5 hover:pl-6'
          }`}
          style={`transition-delay: ${index * 50}ms`}
        >
          {link.label}
        </a>
      ))}
    </div>

    <div class="mt-auto pt-8 border-t border-white/10">
      <a 
        href={`tel:${SITE_CONFIG.phoneTel}`} 
        class="flex items-center justify-center gap-3 w-full py-4 rounded-xl font-bold text-white bg-gradient-to-r from-amber-500 to-amber-600 hover:from-amber-400 hover:to-amber-500 shadow-lg hover:shadow-amber-500/20 transition-all active:scale-95"
      >
        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path d="M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z"></path></svg>
        HEMEN ARA
      </a>
      <div class="mt-6 text-center">
         <p class="text-xs font-mono text-slate-500">YILDIZLAR GRUP TEKNOLOJİ</p>
         <div class="flex items-center justify-center gap-2 mt-1">
           <span class="relative flex h-2 w-2">
             <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span>
             <span class="relative inline-flex rounded-full h-2 w-2 bg-green-500"></span>
           </span>
           <p class="text-[10px] text-slate-600">SYSTEM STATUS: ONLINE</p>
         </div>
      </div>
    </div>
  </div>
</div>

<script>
  // @ts-nocheck
  // Mobile menu toggle logic
  const btn = document.getElementById('mobile-menu-btn');
  const panel = document.getElementById('mobile-menu-panel');
  const menuIcon = document.getElementById('menu-icon');
  const closeIcon = document.getElementById('close-icon');
  let isMenuOpen = false;

  function toggleMenu() {
    isMenuOpen = !isMenuOpen;
    
    if (isMenuOpen) {
      // Menüyü AÇ - Basit ve kesin
      panel?.classList.remove('hidden');
      document.body.style.overflow = 'hidden';
      
      menuIcon?.classList.add('hidden');
      closeIcon?.classList.remove('hidden');
    } else {
      // Menüyü KAPAT
      panel?.classList.add('hidden');
      document.body.style.overflow = '';
      
      menuIcon?.classList.remove('hidden');
      closeIcon?.classList.add('hidden');
    }
  }

  btn?.addEventListener('click', toggleMenu);

  // Sticky header logic
  let ticking = false;
  const header = document.getElementById('header');

  // Matrix Typewriter Logic
  const textElement = document.getElementById('typewriter-text');
  const messages = [
    'İSTANBUL AVRUPA YAKASINDAYIZ',
    'ADRESİMİZ BÜYÜKÇEKMECE, BEYLİKDÜZÜ TEM\' e YAKIN',
    'FİYAT & PERFORMANS OLARAK PİYASANIN EN İYİSİYİZ',
    'ORJİNAL PARÇALAR ve 1. SINIF İŞÇİLİK SUNUYORUZ',
    'LÜTFEN PAZARLIK İÇİN ZORLAMAYINIZ'
  ];
  
  let msgIndex = 0;
  let charIndex = 0;
  let isDeleting = false;
  let typeSpeed = 100;

  // Rastgelelik ve Glitch
  const glitchChars = '!<>-_\\/[]{}—=+*^?#';

  function type() {
    if (!textElement) return;

    const currentMsg = messages[msgIndex];
    
    if (isDeleting) {
      // Silerken daha hızlı ve sabit
      textElement.textContent = currentMsg.substring(0, charIndex - 1);
      charIndex--;
      typeSpeed = 30 + Math.random() * 20; 
    } else {
      // Yazarken rastgele hız ve duraksamalar
      textElement.textContent = currentMsg.substring(0, charIndex + 1);
      
      // Glitch efekti (rastgele karakter gösterip düzeltme) - Sadece yazarken
      if (Math.random() < 0.1 && charIndex < currentMsg.length) {
         const originalChar = textElement.textContent.slice(-1);
         const randomGlitch = glitchChars[Math.floor(Math.random() * glitchChars.length)];
         textElement.textContent = textElement.textContent.slice(0, -1) + randomGlitch;
         
         // Hemen düzelt
         setTimeout(() => {
            if (textElement) textElement.textContent = textElement.textContent.slice(0, -1) + originalChar;
         }, 50);
      }

      charIndex++;
      
      // %15 daha hızlı İnsan gibi yazma hızı (rastgele)
      // Eski Baz: 100 + random(150) = 100..250ms
      // Yeni Baz (%15 Hızlı): 85 + random(120) = 85..205ms
      typeSpeed = 85 + Math.random() * 120;
      
      // Her 6-9 karakterde bir belirgin duraksama (kelime/hece arası gibi)
      // Veya rastgele %15 ihtimalle duraksama
      if (charIndex % (Math.floor(Math.random() * 4) + 6) === 0 || Math.random() < 0.05) {
         typeSpeed += 600 + Math.random() * 400; // 600-1000ms duraksama
      }
    }

    if (!isDeleting && charIndex === currentMsg.length) {
      isDeleting = true;
      typeSpeed = 2500; // Mesajı okumak için bekle
    } else if (isDeleting && charIndex === 0) {
      isDeleting = false;
      msgIndex = (msgIndex + 1) % messages.length;
      typeSpeed = 500;
    }

    setTimeout(type, typeSpeed);
  }

  // Başlat
  if (textElement) {
    setTimeout(type, 1000);
  }

  window.addEventListener('scroll', () => {
    if (!ticking) {
      requestAnimationFrame(() => {
        const isScrolled = window.pageYOffset > 20;
        if (isScrolled) {
           header?.classList.add('bg-[#0f172a]/90', 'shadow-lg');
           header?.style.setProperty('backdrop-filter', 'blur(16px)');
        } else {
           header?.classList.remove('shadow-lg');
           header?.style.setProperty('background', 'rgba(15, 23, 42, 0.8)');
        }
        ticking = false;
      });
      ticking = true;
    }
  }, { passive: true });
</script>

<style is:inline>
  .cursor-blink {
    animation: blink 1s step-end infinite;
  }
  
  .text-shadow-neon {
    text-shadow: 0 0 5px rgba(74, 222, 128, 0.5), 0 0 10px rgba(74, 222, 128, 0.3);
  }

  @keyframes blink {
    0%, 100% { opacity: 1; }
    50% { opacity: 0; }
  }
</style>
