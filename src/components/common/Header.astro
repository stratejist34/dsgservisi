---
import { SITE_CONFIG } from '@utils/constants';

const currentPath = Astro.url.pathname;

const navLinks = [
  { href: '/', label: 'ANASAYFA' },
  { href: '/hizmetlerimiz', label: 'HİZMETLERİMİZ' },
  { href: '/hakkimizda', label: 'HAKKIMIZDA' },
  { href: '/blog', label: 'BLOG' },
  { href: '/iletisim', label: 'İLETİŞİM' },
];
---

<header class="fixed top-0 left-0 right-0 z-40 transition-all duration-300 border-b border-white/5" id="header" style="background: rgba(15, 23, 42, 0.8); backdrop-filter: blur(12px);">
  
  <div class="header-ticker">
    <div class="ticker-track">
      <span id="ticker-message" class="ticker-message"></span>
    </div>
  </div>
  <div class="container relative">
    <div class="flex items-center justify-between h-16 lg:h-[68px]">
      {/* Logo */}
      <a href="/" class="flex items-center gap-3 group relative z-10">
        <div class="relative">
          <img 
            src="/images/DSG Servis logosu.webp" 
            alt="DSG Servisi - Yıldızlar Grup" 
            class="h-8 md:h-10 w-auto transition-all duration-300 group-hover:scale-105 relative z-10 filter brightness-105"
            loading="eager"
            fetchpriority="high"
            width="48"
            height="48"
            decoding="async"
          />
        </div>
      </a>

      {/* Desktop Navigation */}
      <nav class="hidden lg:flex items-center gap-8 relative z-10">
        {navLinks.map((link) => (
          <a
            href={link.href}
            class={`text-sm tracking-wide font-semibold hover:text-white transition-colors duration-200 relative group ${
              currentPath === link.href ? 'text-white' : 'text-slate-400'
            }`}
          >
            {link.label}
            <span class={`absolute -bottom-1 left-0 h-0.5 bg-primary transition-all duration-300 ${currentPath === link.href ? 'w-full' : 'w-0 group-hover:w-full'}`}></span>
          </a>
        ))}
      </nav>

      {/* CTA Button - Solid Tech Look */}
      <a 
        href={`tel:${SITE_CONFIG.phoneTel}`}
        class="hidden md:inline-flex items-center justify-center px-5 py-2.5 rounded text-sm font-bold text-white transition-all duration-300 relative z-10 overflow-hidden group border border-primary/50 bg-primary/10 hover:bg-primary"
        onmousedown="if(window.gtag){window.gtag('event','header_fiyat_iste_butonu',{location:'header_nav'});}"
      >
        <span class="relative z-10 flex items-center gap-2">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/></svg>
          FİYAT İSTE
        </span>
      </a>

      {/* Mobile Menu Button */}
      <button 
        id="mobile-menu-btn"
        class="lg:hidden text-white/90 p-2 relative z-10 hover:text-white transition-all duration-200"
        aria-label="Menüyü Aç"
      >
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
        </svg>
      </button>
    </div>
  </div>

  {/* Mobile Menu */}
  <div id="mobile-menu" class="hidden lg:hidden border-t border-white/10 bg-[#0f172a]/95 backdrop-blur-xl">
    <nav class="container py-4 flex flex-col gap-4">
      {navLinks.map((link) => (
        <a
          href={link.href}
          class={`font-semibold py-3 px-4 rounded hover:bg-white/5 transition-all ${
            currentPath === link.href ? 'text-white bg-white/5' : 'text-slate-400'
          }`}
        >
          {link.label}
        </a>
      ))}
      <a href={`tel:${SITE_CONFIG.phoneTel}`} class="inline-flex justify-center items-center px-6 py-3 rounded font-bold text-white bg-primary hover:bg-primary-600 transition-all mx-4 mb-2">
        HEMEN ARA
      </a>
    </nav>
  </div>
</header>

<script>
  // Mobile menu toggle
  const mobileMenuBtn = document.getElementById('mobile-menu-btn');
  const mobileMenu = document.getElementById('mobile-menu');

  mobileMenuBtn?.addEventListener('click', () => {
    mobileMenu?.classList.toggle('hidden');
  });

  // Sticky header logic
  let ticking = false;
  const header = document.getElementById('header');

  const tickerMessageEl = document.getElementById('ticker-message');
  const tickerMessages = [
    { text: 'İstanbul Avrupa Yakası', color: '#fbbf24' },
    { text: 'Beytepe Sanayi Sitesi', color: '#38bdf8' },
    { text: 'DSG & Mekatronik Tamiri', color: '#f472b6' },
  ];
  let tickerIndex = 0;

  const playTicker = () => {
    if (!tickerMessageEl) return;
    const { text, color } = tickerMessages[tickerIndex];
    tickerMessageEl.textContent = text;
    tickerMessageEl.style.color = color; // Basit renk değişimi
    tickerMessageEl.classList.remove('ticker-animate');
    void tickerMessageEl.offsetWidth;
    tickerMessageEl.classList.add('ticker-animate');
    tickerIndex = (tickerIndex + 1) % tickerMessages.length;
  };

  if (tickerMessageEl) {
    playTicker();
    setInterval(playTicker, 4500);
  }

  window.addEventListener('scroll', () => {
    if (!ticking) {
      requestAnimationFrame(() => {
        const isScrolled = window.pageYOffset > 20;
        if (isScrolled) {
           header?.classList.add('bg-[#0f172a]/90', 'shadow-lg');
           header?.style.setProperty('backdrop-filter', 'blur(16px)');
        } else {
           header?.classList.remove('shadow-lg');
           header?.style.setProperty('background', 'rgba(15, 23, 42, 0.8)');
        }
        ticking = false;
      });
      ticking = true;
    }
  }, { passive: true });
</script>

<style is:inline>
  .header-ticker {
    width: 100%;
    overflow: hidden;
    background: rgba(15, 23, 42, 0.95);
    border-bottom: 1px solid rgba(255, 255, 255, 0.05);
  }

  .ticker-track {
    padding: 4px 16px;
    display: flex;
    justify-content: center;
  }

  .ticker-message {
    font-size: 0.75rem;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    font-weight: 600;
    font-family: monospace;
    opacity: 0;
  }

  .ticker-animate {
    animation: fadeInOut 4.5s ease-in-out forwards;
  }

  @keyframes fadeInOut {
    0%, 100% { opacity: 0; transform: translateY(2px); }
    10%, 90% { opacity: 1; transform: translateY(0); }
  }

  @media (min-width: 1024px) {
    .header-ticker {
      display: none;
    }
  }
</style>
