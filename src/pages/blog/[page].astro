---
import BaseLayout from '@layouts/BaseLayout.astro';
import PostGridPattern from '@components/blog/PostGridPattern.astro';
import { getCollection } from 'astro:content';
import { sortPostsByDate, isPublishedPost } from '@utils/content';

export async function getStaticPaths() {
  const entries = await getCollection('blog', ({ data }) => isPublishedPost(data));
  const posts = sortPostsByDate(entries);
  const PAGE_SIZE = 16;
  const totalPages = Math.ceil(posts.length / PAGE_SIZE) || 1;
  return Array.from({ length: totalPages }, (_, i) => ({
    params: { page: String(i + 1) },
    props: { totalPages, PAGE_SIZE }
  }));
}

const { page } = Astro.params;
const { totalPages, PAGE_SIZE } = Astro.props as { totalPages: number; PAGE_SIZE: number };
const currentPage = Math.max(1, Math.min(Number(page) || 1, totalPages));

const entries = await getCollection('blog', ({ data }) => isPublishedPost(data));
const posts = sortPostsByDate(entries);
const start = (currentPage - 1) * PAGE_SIZE;
const end = start + PAGE_SIZE;
const visiblePosts = posts.slice(start, end);

const title = `Blog Sayfa ${currentPage} | DSG Servisi - DSG Şanzıman ve Mekatronik Bilgi Merkezi`;
const description = 'DSG şanzıman, mekatronik sistemleri ve araç bakımı hakkında bilgilendirici yazılar, ipuçları ve güncellemeler.';
const image = '/images/workshop.jpg';
---

<BaseLayout title={title} description={description} image={image}>
  <!-- Hero Section - Compact -->
  <section class="relative bg-[#0f172a] pt-28 pb-10 overflow-hidden">
    {/* Tech Background Elements */}
    <div class="absolute inset-0 pointer-events-none overflow-hidden">
      <div class="absolute inset-0 opacity-[0.03]" 
           style="background-image: linear-gradient(#fff 1px, transparent 1px), linear-gradient(90deg, #fff 1px, transparent 1px); background-size: 50px 50px;">
      </div>
      <div class="absolute top-[-20%] right-[-10%] w-[400px] h-[400px] bg-amber-500/10 rounded-full blur-[120px] opacity-30"></div>
      <div class="absolute bottom-[-20%] left-[-10%] w-[300px] h-[300px] bg-slate-700/30 rounded-full blur-[100px] opacity-30"></div>
    </div>

    <div class="container relative z-10">
      <div class="max-w-4xl mx-auto text-center">
        {/* Tech Badge */}
        <div class="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-white/5 border border-white/10 backdrop-blur-md mb-6" data-reveal>
          <span class="flex h-2 w-2 rounded-full bg-primary animate-pulse"></span>
          <span class="text-primary text-xs font-bold tracking-widest uppercase font-mono">SAYFA {currentPage} / {totalPages}</span>
          <span class="text-slate-400 text-xs uppercase tracking-widest border-l border-white/10 pl-2 ml-2">{posts.length} YAZI</span>
        </div>

        {/* Title */}
        <h1 class="font-display font-bold text-4xl md:text-5xl mb-4 text-white leading-tight" data-reveal>
          <span class="text-stroke text-transparent">DSG & MEKATRONİK</span>
          <span class="block text-primary mt-2">BİLGİ MERKEZİ</span>
        </h1>
        
        {/* Breadcrumb Style Navigation */}
        <div class="flex items-center justify-center gap-2 text-sm text-slate-400 mt-6" data-reveal>
          <a href="/blog" class="hover:text-primary transition-colors">Blog</a>
          <span class="text-slate-600">/</span>
          <span class="text-white">Sayfa {currentPage}</span>
        </div>
      </div>
    </div>
    
    <div class="absolute bottom-0 left-0 right-0 h-px bg-gradient-to-r from-transparent via-white/10 to-transparent"></div>
  </section>

  <!-- Blog Grid -->
  <section class="section relative bg-[#0f172a] pt-8 overflow-hidden">
    {/* Subtle Background Elements */}
    <div class="absolute inset-0 pointer-events-none">
      <div class="absolute top-0 left-1/4 w-[500px] h-[500px] bg-amber-500/5 rounded-full blur-[150px]"></div>
      <div class="absolute bottom-0 right-1/4 w-[400px] h-[400px] bg-slate-700/30 rounded-full blur-[120px]"></div>
    </div>
    
    <div class="container relative z-10">
      <PostGridPattern posts={visiblePosts} />
      
      {/* Pagination */}
      {totalPages > 1 && (
        <nav class="mt-12 flex flex-wrap justify-center gap-2" aria-label="Sayfalama">
          {/* Previous Button */}
          {currentPage > 1 && (
            <a 
              href={currentPage === 2 ? '/blog' : `/blog/${currentPage - 1}`} 
              class="px-4 py-2 rounded-lg bg-slate-800/80 hover:bg-slate-700 text-slate-300 hover:text-white border border-white/10 transition-all flex items-center gap-1"
            >
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
              Önceki
            </a>
          )}
          
          {/* Page Numbers */}
          {Array.from({ length: totalPages }, (_, i) => i + 1).map((p) => (
            p === currentPage ? (
              <span class="px-4 py-2 rounded-lg bg-primary text-white font-semibold" aria-current="page">{p}</span>
            ) : (
              <a href={p === 1 ? '/blog' : `/blog/${p}`} class="px-4 py-2 rounded-lg bg-slate-800/80 hover:bg-slate-700 text-slate-300 hover:text-white border border-white/10 transition-all">{p}</a>
            )
          ))}
          
          {/* Next Button */}
          {currentPage < totalPages && (
            <a 
              href={`/blog/${currentPage + 1}`} 
              class="px-4 py-2 rounded-lg bg-slate-800/80 hover:bg-slate-700 text-slate-300 hover:text-white border border-white/10 transition-all flex items-center gap-1"
            >
              Sonraki
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
            </a>
          )}
        </nav>
      )}
    </div>
  </section>
</BaseLayout>


