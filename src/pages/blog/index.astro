---
import BaseLayout from '@layouts/BaseLayout.astro';
import BlogCard from '@components/blog/BlogCard.astro';
import PostGridPattern from '@components/blog/PostGridPattern.astro';
import { getCollection } from 'astro:content';
import { sortPostsByDate, getCategoriesWithCounts, getCategoryLogo, getCategoryLink, isPublishedPost } from '@utils/content';

const title = 'Blog | DSG Servisi - DSG Şanzıman ve Mekatronik Bilgi Merkezi';
const description = 'DSG şanzıman, mekatronik sistemleri ve araç bakımı hakkında bilgilendirici yazılar, ipuçları ve güncellemeler. Uzman görüşleri ve pratik çözümler.';
const image = '/images/workshop.jpg';

// Content Collections'dan yazıları al ve tarihe göre sırala
// Gelecek tarihli yazıları filtrele (scheduled posts)
const entries = await getCollection('blog', ({ data }) => isPublishedPost(data));
const posts = sortPostsByDate(entries);
const PAGE_SIZE = 16;
const currentPage = 1;
const totalPages = Math.ceil(posts.length / PAGE_SIZE) || 1;
const visiblePosts = posts.slice(0, PAGE_SIZE);

// Kategorileri al ve logo/link bilgileriyle eşleştir
const categoriesWithCounts = getCategoriesWithCounts(posts);
// Öncelikli kategori sırası: Markalar önce, sonra DSG
const priorityOrder = ['Audi', 'BMW', 'Mercedes', 'Land Rover', 'Porsche', 'Seat', 'Skoda', 'Volkswagen', 'DSG'];
const categoryLogos = categoriesWithCounts
  .filter(cat => getCategoryLogo(cat.name)) // Logo olan kategorileri filtrele
  .sort((a, b) => {
    // Öncelikli sıraya göre sırala
    const indexA = priorityOrder.indexOf(a.name);
    const indexB = priorityOrder.indexOf(b.name);
    
    // Eğer her ikisi de öncelikli listede değilse, sayıya göre sırala
    if (indexA === -1 && indexB === -1) {
      return b.count - a.count;
    }
    // Eğer sadece biri listede değilse, listede olan önce gelsin
    if (indexA === -1) return 1;
    if (indexB === -1) return -1;
    // İkisi de listede ise, öncelik sırasına göre
    return indexA - indexB;
  })
  .map(cat => ({
    name: cat.name,
    logo: getCategoryLogo(cat.name)!,
    link: getCategoryLink(cat.name),
    count: cat.count
  }))
  .slice(0, 9); // Max 9 kategori göster (8 marka + DSG)
---

<BaseLayout title={title} description={description} image={image}>
  <!-- Hero Section - Cyberpunk Tech Style -->
  <section class="relative min-h-[36vh] flex items-center justify-center overflow-hidden bg-[#0f172a] pt-16 pb-6">
    {/* Tech Background Elements */}
    <div class="absolute inset-0 pointer-events-none overflow-hidden">
      {/* Grid Overlay */}
      <div class="absolute inset-0 opacity-[0.03]" 
           style="background-image: linear-gradient(#fff 1px, transparent 1px), linear-gradient(90deg, #fff 1px, transparent 1px); background-size: 50px 50px;">
      </div>
      
      {/* Glowing Orbs */}
      <div class="absolute top-[-20%] right-[-10%] w-[600px] h-[600px] bg-amber-500/10 rounded-full blur-[120px] opacity-30"></div>
      <div class="absolute bottom-[-20%] left-[-10%] w-[500px] h-[500px] bg-blue-900/20 rounded-full blur-[100px] opacity-30"></div>
    </div>

    <div class="container relative z-10" style="margin-top: -40px;">
      <div class="max-w-4xl mx-auto text-center">
        {/* Tech Badge */}
        <div class="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-white/5 border border-white/10 backdrop-blur-md mb-6" data-reveal>
          <span class="flex h-2 w-2 rounded-full bg-primary animate-pulse"></span>
          <span class="text-primary text-xs font-bold tracking-widest uppercase font-mono">DATABASE: ONLINE</span>
          <span class="text-slate-400 text-xs uppercase tracking-widest border-l border-white/10 pl-2 ml-2">KNOWLEDGE BASE v2.0</span>
        </div>

        {/* Main Title - Tech Style */}
        <h1 class="font-display font-bold text-5xl md:text-7xl mb-8 text-white leading-tight" data-reveal>
          <span class="block text-stroke text-transparent hover:text-white transition-colors duration-500 cursor-default">DSG & MEKATRONİK</span>
          <span class="block text-primary mt-2">BİLGİ MERKEZİ</span>
        </h1>
        
        {/* Digital Ticker - Son Yazılar */}
        <div class="relative w-full max-w-3xl mx-auto" data-reveal>
          {/* Ticker Container */}
          <div class="relative overflow-hidden rounded-lg bg-[#1e293b]/80 border border-white/10 backdrop-blur-sm">
            {/* Ticker Header */}
            <div class="flex items-center gap-2 px-4 py-2 border-b border-white/10 bg-[#0f172a]/50">
              <div class="flex gap-1">
                <span class="w-2 h-2 rounded-full bg-red-500/80"></span>
                <span class="w-2 h-2 rounded-full bg-amber-500/80"></span>
                <span class="w-2 h-2 rounded-full bg-green-500/80"></span>
              </div>
              <span class="text-[10px] font-mono text-primary tracking-widest uppercase ml-2">LIVE FEED</span>
              <span class="flex h-1.5 w-1.5 rounded-full bg-green-400 animate-pulse ml-auto"></span>
            </div>
            
            {/* Scrolling Content */}
            <div class="ticker-wrapper py-3 px-4">
              <div class="ticker-content flex gap-8 whitespace-nowrap">
                {posts.slice(0, 10).map((post, i) => (
                  <a 
                    href={`/blog/${post.slug}`} 
                    class="inline-flex items-center gap-3 text-slate-300 hover:text-primary transition-colors group"
                  >
                    <span class="font-mono text-[10px] text-primary/60 border border-primary/30 px-1.5 py-0.5 rounded">
                      {String(i + 1).padStart(2, '0')}
                    </span>
                    <span class="text-sm font-medium group-hover:text-primary transition-colors">
                      {post.data.title}
                    </span>
                    <span class="text-primary/40">│</span>
                  </a>
                ))}
                {/* Duplicate for seamless loop */}
                {posts.slice(0, 10).map((post, i) => (
                  <a 
                    href={`/blog/${post.slug}`} 
                    class="inline-flex items-center gap-3 text-slate-300 hover:text-primary transition-colors group"
                  >
                    <span class="font-mono text-[10px] text-primary/60 border border-primary/30 px-1.5 py-0.5 rounded">
                      {String(i + 1).padStart(2, '0')}
                    </span>
                    <span class="text-sm font-medium group-hover:text-primary transition-colors">
                      {post.data.title}
                    </span>
                    <span class="text-primary/40">│</span>
                  </a>
                ))}
              </div>
            </div>
          </div>
          
          {/* Edge Fades */}
          <div class="absolute left-0 top-0 bottom-0 w-12 bg-gradient-to-r from-[#0f172a] to-transparent pointer-events-none z-10 rounded-l-lg"></div>
          <div class="absolute right-0 top-0 bottom-0 w-12 bg-gradient-to-l from-[#0f172a] to-transparent pointer-events-none z-10 rounded-r-lg"></div>
        </div>
      </div>
    </div>
    
    {/* Bottom Tech Line */}
    <div class="absolute bottom-0 left-0 right-0 h-px bg-gradient-to-r from-transparent via-white/10 to-transparent"></div>
  </section>
  
  <style>
    .ticker-wrapper {
      overflow: hidden;
    }
    
    .ticker-content {
      animation: ticker 10s linear infinite;
    }
    
    .ticker-content:hover {
      animation-play-state: paused;
    }
    
    @keyframes ticker {
      0% {
        transform: translateX(0);
      }
      100% {
        transform: translateX(-50%);
      }
    }
  </style>

  <!-- Category Logos Section - Minimal Tech Style -->
  {categoryLogos.length > 0 && (
    <section class="section bg-[#0f172a] border-b border-white/5 py-8">
      <div class="container">
        <div class="flex flex-nowrap justify-center gap-6 mt-4 md:mt-6 max-w-6xl mx-auto overflow-x-auto px-4 pb-4">
          {categoryLogos.map((category, i) => {
            const dir = i < 5 ? 'ltr' : 'rtl';
            const distFromEdge = Math.min(i, 8 - i);
            const staggerIndex = Math.min(4, 4 - distFromEdge);
            return (
              <a
                href={category.link}
                class="group relative w-16 h-16 md:w-20 md:h-20 flex-shrink-0 block logo-anim"
                aria-label={`${category.name} Kategorisi`}
                data-reveal
                data-dir={dir}
                data-stagger-index={String(staggerIndex)}
                data-stagger-step="240"
              >
                {/* Hover Glow Effect */}
                <div class="absolute inset-0 rounded-full bg-primary/20 blur-md opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>

                {/* Logo Container - Tech Border */}
                <div class="absolute inset-0 flex items-center justify-center rounded-full bg-[#1e293b] border border-white/10 group-hover:border-primary/50 transition-all duration-300 z-10 shadow-lg group-hover:shadow-primary/20">
                  {/* Logo Image - Always White, Hover Scale */}
                  <img
                    src={category.logo}
                    alt={`${category.name} Kategorisi`}
                    class="w-[32px] h-[32px] md:w-[40px] md:h-[40px] object-contain filter brightness-0 invert opacity-60 group-hover:opacity-100 group-hover:scale-110 transition-all duration-300"
                    loading="lazy"
                    width="52"
                    height="52"
                    decoding="async"
                  />
                </div>
              </a>
            );
          })}
        </div>
      </div>
    </section>
  )}

  <!-- Blog Grid - CSS Pattern Based Layout -->
  <section class="section relative bg-[#0f172a] pt-4 md:pt-6 overflow-hidden">
    {/* Subtle Background Elements */}
    <div class="absolute inset-0 pointer-events-none">
      <div class="absolute top-0 left-1/4 w-[500px] h-[500px] bg-amber-500/5 rounded-full blur-[150px]"></div>
      <div class="absolute bottom-0 right-1/4 w-[400px] h-[400px] bg-slate-700/30 rounded-full blur-[120px]"></div>
    </div>
    
    <div class="container relative z-10">
      {posts.length > 0 ? (
        <>
          <PostGridPattern posts={visiblePosts} />
          {totalPages > 1 && (
            <nav class="mt-12 flex justify-center gap-2" aria-label="Sayfalama">
              {Array.from({ length: totalPages }, (_, i) => i + 1).map((p) => (
                p === currentPage ? (
                  <span class="px-4 py-2 rounded-lg bg-primary text-white font-semibold" aria-current="page">{p}</span>
                ) : (
                  <a href={p === 1 ? '/blog' : `/blog/${p}`} class="px-4 py-2 rounded-lg bg-slate-800/80 hover:bg-slate-700 text-slate-300 hover:text-white border border-white/10 transition-all">{p}</a>
                )
              ))}
            </nav>
          )}
        </>
      ) : (
        <div class="text-center py-20">
          <div class="relative inline-block mb-6">
            <div class="w-24 h-24 bg-gradient-to-br from-primary/20 to-amber-600/20 rounded-2xl flex items-center justify-center mx-auto border border-white/10">
              <svg class="w-12 h-12 text-primary" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
              </svg>
            </div>
          </div>
          <h3 class="text-3xl font-display font-bold text-white mb-4">Henüz Blog Yazısı Yok</h3>
          <p class="text-lg text-slate-400 mb-8 max-w-md mx-auto">
            Yakında burada DSG şanzıman ve araç bakımı hakkında faydalı içerikler paylaşılacak
          </p>
          <div class="flex gap-4 justify-center">
            <a href="/" class="btn bg-gradient-to-r from-primary to-amber-600 text-white hover:shadow-lg hover:shadow-primary/50 transition-all px-6 py-3 rounded-xl font-semibold">
              Ana Sayfaya Dön
            </a>
            <a href="/hizmetlerimiz" class="btn bg-slate-800/50 text-white border border-white/20 hover:bg-slate-700 hover:border-primary/50 transition-all px-6 py-3 rounded-xl font-semibold">
              Hizmetlerimiz
            </a>
          </div>
        </div>
      )}
    </div>
  </section>

  <!-- CTA Section - Tech Style -->
  <section class="section relative bg-[#0f172a] overflow-hidden border-t border-white/5">
    {/* Background Elements */}
    <div class="absolute inset-0 pointer-events-none">
      {/* Grid Pattern */}
      <div class="absolute inset-0 opacity-[0.02]" 
           style="background-image: linear-gradient(#fff 1px, transparent 1px), linear-gradient(90deg, #fff 1px, transparent 1px); background-size: 60px 60px;">
      </div>
      {/* Glowing Orbs */}
      <div class="absolute top-[-10%] right-[-5%] w-[400px] h-[400px] bg-amber-500/10 rounded-full blur-[100px]"></div>
      <div class="absolute bottom-[-10%] left-[-5%] w-[350px] h-[350px] bg-slate-600/20 rounded-full blur-[80px]"></div>
    </div>

    <div class="container relative z-10">
      <div class="max-w-3xl mx-auto text-center" data-animate>
        {/* Tech Badge */}
        <div class="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-white/5 border border-white/10 backdrop-blur-md mb-6">
          <span class="flex h-2 w-2 rounded-full bg-primary animate-pulse"></span>
          <span class="text-primary text-xs font-bold tracking-widest uppercase font-mono">EXPERT SERVICE</span>
        </div>

        <h2 class="text-3xl md:text-4xl lg:text-5xl font-display font-bold text-white mb-6" data-animate>
          Aracınız İçin <span class="text-transparent bg-clip-text bg-gradient-to-r from-primary via-amber-400 to-primary">Profesyonel Hizmet</span>
        </h2>
        
        <p class="text-lg md:text-xl text-slate-400 mb-10 leading-relaxed" data-animate>
          DSG şanzıman ve mekatronik uzmanlarımızla tanışın. 
          <span class="text-white font-semibold">15 yıllık deneyim</span> ve 
          <span class="text-primary font-semibold">6500+ mutlu müşteri</span>
        </p>
        
        <div class="flex flex-col sm:flex-row gap-4 justify-center" data-stagger-children data-stagger-step="90">
          <a
            href="/iletisim"
            class="group relative inline-flex items-center justify-center gap-2 bg-gradient-to-r from-primary to-amber-600 text-white px-8 py-4 rounded-xl font-semibold text-lg shadow-xl hover:shadow-2xl hover:shadow-primary/30 transition-all duration-300 hover:-translate-y-1"
            data-animate
          >
            <svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
            </svg>
            Hemen Ara
            <svg class="w-5 h-5 transform group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" d="M13 7l5 5m0 0l-5 5m5-5H6" />
            </svg>
          </a>
          <a
            href="/hizmetlerimiz"
            class="group inline-flex items-center justify-center gap-2 bg-slate-800/50 text-white border border-white/20 hover:bg-slate-700 hover:border-primary/50 px-8 py-4 rounded-xl font-semibold text-lg transition-all duration-300 hover:-translate-y-1"
            data-animate
          >
            Hizmetlerimiz
            <svg class="w-5 h-5 transform group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" d="M13 7l5 5m0 0l-5 5m5-5H6" />
            </svg>
          </a>
        </div>

        {/* Stats - Tech Cards */}
        <div class="grid grid-cols-3 gap-4 md:gap-6 mt-12 pt-12 border-t border-white/10">
          <div class="p-4 rounded-xl bg-slate-800/30 border border-white/5 backdrop-blur-sm">
            <div class="text-2xl md:text-4xl font-display font-black text-white mb-1">15+</div>
            <div class="text-xs md:text-sm text-slate-500 uppercase tracking-wider">Yıl Deneyim</div>
          </div>
          <div class="p-4 rounded-xl bg-slate-800/30 border border-white/5 backdrop-blur-sm">
            <div class="text-2xl md:text-4xl font-display font-black text-primary mb-1">6.5K+</div>
            <div class="text-xs md:text-sm text-slate-500 uppercase tracking-wider">Mutlu Müşteri</div>
          </div>
          <div class="p-4 rounded-xl bg-slate-800/30 border border-white/5 backdrop-blur-sm">
            <div class="text-2xl md:text-4xl font-display font-black text-white mb-1">8</div>
            <div class="text-xs md:text-sm text-slate-500 uppercase tracking-wider">Premium Marka</div>
          </div>
        </div>
      </div>
    </div>
  </section>
</BaseLayout>


