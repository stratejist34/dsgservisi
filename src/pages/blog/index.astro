---
import BaseLayout from '@layouts/BaseLayout.astro';
import BlogCard from '@components/blog/BlogCard.astro';
import PostGridPattern from '@components/blog/PostGridPattern.astro';
import { getCollection } from 'astro:content';
import { sortPostsByDate, getCategoriesWithCounts, getCategoryLogo, getCategoryLink, isPublishedPost } from '@utils/content';

const title = 'Blog | DSG Servisi - DSG Şanzıman ve Mekatronik Bilgi Merkezi';
const description = 'DSG şanzıman, mekatronik sistemleri ve araç bakımı hakkında bilgilendirici yazılar, ipuçları ve güncellemeler. Uzman görüşleri ve pratik çözümler.';
const image = '/images/workshop.jpg';

// Content Collections'dan yazıları al ve tarihe göre sırala
// Gelecek tarihli yazıları filtrele (scheduled posts)
const entries = await getCollection('blog', ({ data }) => isPublishedPost(data));
const posts = sortPostsByDate(entries);
const PAGE_SIZE = 16;
const currentPage = 1;
const totalPages = Math.ceil(posts.length / PAGE_SIZE) || 1;
const visiblePosts = posts.slice(0, PAGE_SIZE);

// Kategorileri al ve logo/link bilgileriyle eşleştir
const categoriesWithCounts = getCategoriesWithCounts(posts);
// Öncelikli kategori sırası: Markalar önce, sonra DSG
const priorityOrder = ['Audi', 'BMW', 'Mercedes', 'Land Rover', 'Porsche', 'Seat', 'Skoda', 'Volkswagen', 'DSG'];
const categoryLogos = categoriesWithCounts
  .filter(cat => getCategoryLogo(cat.name)) // Logo olan kategorileri filtrele
  .sort((a, b) => {
    // Öncelikli sıraya göre sırala
    const indexA = priorityOrder.indexOf(a.name);
    const indexB = priorityOrder.indexOf(b.name);
    
    // Eğer her ikisi de öncelikli listede değilse, sayıya göre sırala
    if (indexA === -1 && indexB === -1) {
      return b.count - a.count;
    }
    // Eğer sadece biri listede değilse, listede olan önce gelsin
    if (indexA === -1) return 1;
    if (indexB === -1) return -1;
    // İkisi de listede ise, öncelik sırasına göre
    return indexA - indexB;
  })
  .map(cat => ({
    name: cat.name,
    logo: getCategoryLogo(cat.name)!,
    link: getCategoryLink(cat.name),
    count: cat.count
  }))
  .slice(0, 9); // Max 9 kategori göster (8 marka + DSG)
---

<BaseLayout title={title} description={description} image={image}>
  <!-- Hero Section - Modern Premium -->
  <section class="relative min-h-[28vh] flex items-center justify-center overflow-hidden">
    {/* Background Image */}
    <div class="absolute inset-0">
      <img 
        src="/images/workshop.jpg" 
        alt="DSG Blog" 
        class="w-full h-full object-cover"
        width="1920"
        height="1080"
      />
      <div class="absolute inset-0 bg-gradient-to-br from-navy/65 via-navy/60 to-navy/65"></div>
    </div>

    {/* Pattern (static) */}
    <div class="absolute inset-0 opacity-10">
      <div class="absolute inset-0" style="background-image: url('data:image/svg+xml,%3Csvg width=\'60\' height=\'60\' viewBox=\'0 0 60 60\' xmlns=\'http://www.w3.org/2000/svg\'%3E%3Cg fill=\'none\' fill-rule=\'evenodd\'%3E%3Cg fill=\'%231a9cb0\' fill-opacity=\'0.4\'%3E%3Cpath d=\'M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z\'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E');"></div>
    </div>
    {/* Stars removed for performance */}
 
    <div class="container relative z-10 py-8">
      <div class="max-w-4xl mx-auto text-center">
        {/* Badge */}
        <div class="inline-flex items-center gap-2 bg-white/10 text-white px-6 py-2 rounded-full mb-3" data-reveal>
          <svg class="w-5 h-5 text-cyan" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
          </svg>
          <span class="font-semibold">Bilgi & İpuçları</span>
        </div>
 
        <h1 class="text-3xl md:text-4xl lg:text-5xl font-display font-bold text-white mb-3" data-reveal>
          DSG <span class="text-transparent bg-clip-text bg-gradient-to-r from-primary via-cyan to-primary">Bilgi Merkezi</span>
        </h1>
        
        <p class="text-base md:text-lg text-gray-300 leading-relaxed max-w-3xl mx-auto" data-reveal>
          DSG şanzıman, mekatronik sistemleri ve araç bakımı hakkında uzman görüşleri, 
          pratik ipuçları ve güncel haberler
        </p>
      </div>
    </div>
  </section>

  <!-- Category Logos Section -->
  {categoryLogos.length > 0 && (
    <section class="section bg-white py-4 md:py-6">
      <div class="container">
        <div class="flex flex-nowrap justify-center gap-3 md:gap-4 lg:gap-6 mt-4 md:mt-6 max-w-6xl mx-auto overflow-x-auto px-4">
          {categoryLogos.map((category, i) => {
            const dir = i < 5 ? 'ltr' : 'rtl';
            const distFromEdge = Math.min(i, 8 - i);
            const staggerIndex = Math.min(4, 4 - distFromEdge);
            return (
              <a
                href={category.link}
                class="group relative w-14 h-14 md:w-16 md:h-16 lg:w-20 lg:h-20 flex-shrink-0 block logo-anim"
                aria-label={`${category.name} Kategorisi`}
                data-reveal
                data-dir={dir}
                data-stagger-index={String(staggerIndex)}
                data-stagger-step="240"
              >
                {/* Dönen Border Dairesi - 2px kalınlık */}
                <div 
                  class="absolute inset-0 rounded-full z-0 group-hover:opacity-0 transition-opacity duration-300"
                  style={{
                    background: `conic-gradient(from 0deg, #00d4ff, #1a9cb0, #5dd3e0, #00d4ff)`,
                  }}
                />

                {/* Hover - Border Kalınlaşır (3px) */}
                <div 
                  class="absolute inset-0 rounded-full opacity-0 group-hover:opacity-100 transition-opacity duration-300 z-0"
                  style={{
                    background: `conic-gradient(from 0deg, #00d4ff, #1a9cb0, #5dd3e0, #00d4ff)`,
                  }}
                />

                {/* Logo Container ÜSTTE - Normal 2px, Hover 3px border */}
                <div class="absolute inset-[2px] group-hover:inset-[3px] flex items-center justify-center rounded-full bg-navy cursor-pointer transition-all duration-300 z-10">
                  {/* Logo Image - Hover'da scale */}
                  <img
                    src={category.logo}
                    alt={`${category.name} Kategorisi`}
                    class="w-[36px] h-[36px] md:w-[46px] md:h-[46px] lg:w-[52px] lg:h-[52px] object-contain filter brightness-0 invert opacity-80 group-hover:opacity-100 group-hover:scale-110 transition-all duration-300"
                    loading="lazy"
                    width="52"
                    height="52"
                    decoding="async"
                  />
                </div>
              </a>
            );
          })}
        </div>
      </div>
    </section>
  )}

  <!-- Blog Grid - CSS Pattern Based Layout -->
  <section class="section bg-gradient-to-b from-gray-50 to-white pt-4 md:pt-6">
    <div class="container">
      {posts.length > 0 ? (
        <>
          <PostGridPattern posts={visiblePosts} />
          {totalPages > 1 && (
            <nav class="mt-12 flex justify-center gap-2" aria-label="Sayfalama">
              {Array.from({ length: totalPages }, (_, i) => i + 1).map((p) => (
                p === currentPage ? (
                  <span class="px-4 py-2 rounded-lg bg-primary text-white" aria-current="page">{p}</span>
                ) : (
                  <a href={p === 1 ? '/blog' : `/blog/${p}`} class="px-4 py-2 rounded-lg bg-gray-100 hover:bg-gray-200 text-navy">{p}</a>
                )
              ))}
            </nav>
          )}
        </>
      ) : (
        <div class="text-center py-20">
          <div class="relative inline-block mb-6">
            <div class="w-24 h-24 bg-gradient-to-br from-primary/20 to-cyan/20 rounded-2xl flex items-center justify-center mx-auto">
              <svg class="w-12 h-12 text-primary" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
              </svg>
            </div>
          </div>
          <h3 class="text-3xl font-display font-bold text-navy mb-4">Henüz Blog Yazısı Yok</h3>
          <p class="text-lg text-gray-600 mb-8 max-w-md mx-auto">
            Yakında burada DSG şanzıman ve araç bakımı hakkında faydalı içerikler paylaşılacak
          </p>
          <div class="flex gap-4 justify-center">
            <a href="/" class="btn bg-gradient-to-r from-primary to-cyan text-white hover:shadow-lg hover:shadow-primary/50 transition-all">
              Ana Sayfaya Dön
            </a>
            <a href="/hizmetlerimiz" class="btn bg-white text-navy border-2 border-navy hover:bg-navy hover:text-white transition-all">
              Hizmetlerimiz
            </a>
          </div>
        </div>
      )}
    </div>
  </section>

  <!-- CTA Section - Modern -->
  <section class="section relative bg-gradient-to-br from-navy via-navy-600 to-navy overflow-hidden">
    {/* Background (static) */}
    <div class="absolute inset-0 opacity-10">
      <div class="absolute inset-0" style="background-image: url('data:image/svg+xml,%3Csvg width=\'60\' height=\'60\' viewBox=\'0 0 60 60\' xmlns=\'http://www.w3.org/2000/svg\'%3E%3Cg fill=\'none\' fill-rule=\'evenodd\'%3E%3Cg fill=\'%231a9cb0\' fill-opacity=\'0.4\'%3E%3Cpath d=\'M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4H6zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z\'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E');"></div>
    </div>

    {/* Heavy orbs removed */}

    <div class="container relative z-10">
      <div class="max-w-3xl mx-auto text-center" data-animate>
        {/* Icon */}
        <div class="inline-flex items-center justify-center w-20 h-20 bg-gradient-to-br from-primary to-cyan rounded-2xl mb-6 shadow-xl">
          <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" d="M13 10V3L4 14h7v7l9-11h-7z" />
          </svg>
        </div>

        <h2 class="text-3xl md:text-4xl lg:text-5xl font-display font-bold text-white mb-6" data-animate>
          Aracınız İçin <span class="text-transparent bg-clip-text bg-gradient-to-r from-primary via-cyan to-primary">Profesyonel Hizmet</span>
        </h2>
        
        <p class="text-lg md:text-xl text-white/90 mb-10 leading-relaxed" data-animate>
          DSG şanzıman ve mekatronik uzmanlarımızla tanışın. 
          <span class="text-cyan font-semibold">15 yıllık deneyim</span> ve 
          <span class="text-cyan font-semibold">6500+ mutlu müşteri</span>
        </p>
        
        <div class="flex flex-col sm:flex-row gap-4 justify-center" data-stagger-children data-stagger-step="90">
          <a
            href="/iletisim"
            class="group relative inline-flex items-center justify-center gap-2 bg-gradient-to-r from-primary to-cyan text-white px-8 py-4 rounded-xl font-semibold text-lg shadow-xl hover:shadow-2xl hover:shadow-primary/50 transition-all duration-300 hover:-translate-y-1"
            data-animate
          >
            <svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
            </svg>
            Hemen Ara
            <svg class="w-5 h-5 transform group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" d="M13 7l5 5m0 0l-5 5m5-5H6" />
            </svg>
          </a>
          <a
            href="/hizmetlerimiz"
            class="group inline-flex items-center justify-center gap-2 bg-white/10 text-white border-2 border-white/30 hover:bg-white hover:text-navy px-8 py-4 rounded-xl font-semibold text-lg transition-all duration-300 hover:-translate-y-1"
            data-animate
          >
            Hizmetlerimiz
            <svg class="w-5 h-5 transform group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" d="M13 7l5 5m0 0l-5 5m5-5H6" />
            </svg>
          </a>
        </div>

        {/* Stats */}
        <div class="grid grid-cols-3 gap-6 mt-12 pt-12 border-t border-white/20">
          <div class="text-center">
            <div class="text-3xl md:text-4xl font-display font-black text-white mb-2">15+</div>
            <div class="text-sm text-white/80">Yıl Deneyim</div>
          </div>
          <div class="text-center">
            <div class="text-3xl md:text-4xl font-display font-black text-white mb-2">6.5K+</div>
            <div class="text-sm text-white/80">Mutlu Müşteri</div>
          </div>
          <div class="text-center">
            <div class="text-3xl md:text-4xl font-display font-black text-white mb-2">8</div>
            <div class="text-sm text-white/80">Premium Marka</div>
          </div>
        </div>
      </div>
    </div>
  </section>
</BaseLayout>


